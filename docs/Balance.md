# 밸런스 및 시너지 시스템 (Balance & Synergy)

## 개요

**덱빌딩 랜덤 스킬 시스템** 기반의 밸런스 공식과 시너지 시스템을 정의합니다.
매 턴 10개 슬롯 중 랜덤 1개 스킬이 발동되므로, **기대값(Expected Value)** 기반 밸런싱이 핵심입니다.

---

## 덱빌딩 밸런스 핵심 원칙

### 확률 기반 기대값 계산
```
턴당 기대 데미지 = Σ(스킬 데미지 × 발동 확률)

예시: 강타(100%) 3개, 화염구(100%) 5개, 치유(0%) 2개
- 강타 기대값: 100% × 0.3 = 30%
- 화염구 기대값: 100% × 0.5 = 50%
- 치유 기대값: 0% × 0.2 = 0%
- 턴당 기대 데미지: 80% (공격력 기준)
```

### 덱 구성 밸런스 기준
| 덱 타입 | 공격 스킬 | 방어/힐 | 턴당 기대 DPS | 생존력 |
|---------|----------|---------|--------------|--------|
| 올공격 | 10개 | 0개 | 100-150% | 최하 |
| 공격형 | 7개 | 3개 | 70-110% | 하 |
| 밸런스 | 5개 | 5개 | 50-80% | 중 |
| 방어형 | 3개 | 7개 | 30-50% | 상 |
| 극방어 | 1개 | 9개 | 10-20% | 최상 |

---

## 기본 스탯 공식

### 플레이어 스탯 성장

```
기본 HP = 100 + (레벨 × 20)
기본 Attack = 10 + (레벨 × 2)
기본 AP_Attack = 5 + (레벨 × 1.5)
기본 AD_Defense = 5 + (레벨 × 1)
기본 AP_Defense = 5 + (레벨 × 1)
기본 Speed = 10 (선공권 결정)
기본 Accuracy = 90%
기본 Evasion = 5%
기본 Critical Rate = 5%
기본 Critical Damage = 150%
```

### 레벨별 기본 스탯 테이블
| 레벨 | HP | Attack | AP_Atk | AD_Def | AP_Def |
|------|-----|--------|--------|--------|--------|
| 1 | 120 | 12 | 7 | 6 | 6 |
| 10 | 300 | 30 | 20 | 15 | 15 |
| 20 | 500 | 50 | 35 | 25 | 25 |
| 30 | 700 | 70 | 50 | 35 | 35 |
| 40 | 900 | 90 | 65 | 45 | 45 |
| 50 | 1100 | 110 | 80 | 55 | 55 |
| 60 | 1400 | 140 | 100 | 70 | 70 |
| 70 | 1800 | 180 | 130 | 90 | 90 |
| 80 | 2300 | 230 | 170 | 115 | 115 |
| 90 | 2900 | 290 | 220 | 145 | 145 |
| 100 | 3600 | 360 | 280 | 180 | 180 |

### 고레벨 스탯 성장 공식 (Lv.51+)
```
HP = 100 + (50 × 20) + ((레벨 - 50) × 30) + (레벨 - 50)²/10
Attack = 10 + (50 × 2) + ((레벨 - 50) × 3) + (레벨 - 50)/5
AP_Attack = 5 + (50 × 1.5) + ((레벨 - 50) × 2.5) + (레벨 - 50)/5
AD_Defense = 5 + (50 × 1) + ((레벨 - 50) × 1.5) + (레벨 - 50)/8
AP_Defense = 5 + (50 × 1) + ((레벨 - 50) × 1.5) + (레벨 - 50)/8
```

---

## 자연 회복 시스템

### 기본 자연 회복
```
기본 HP 회복량 = 5 HP/분
회복 적용 시점 = HP 정보 표시 시 자동 적용 (던전 입장, /내정보 등)
```

### 자연 회복 스탯 (hp_regen)
| 레벨 구간 | 기본 회복량 | 비고 |
|-----------|-------------|------|
| 1-10 | 5 HP/분 | 초보자 |
| 11-20 | 8 HP/분 | 장비로 증가 가능 |
| 21-30 | 12 HP/분 | 중급자 |
| 31-40 | 18 HP/분 | 고급자 |
| 41-50 | 25 HP/분 | 엘리트 |
| 51+ | 35+ HP/분 | 고레벨 |

> 자연 회복 보너스 아이템은 [Items.md](Items.md)의 악세서리 섹션 참조

### 사망 패널티
```
사망 시:
- HP가 1로 설정됨
- 획득 골드 10% 손실

사망 후 던전 재입장:
- HP 30% 미만일 경우 입장 불가
- 자연 회복 또는 힐링 아이템으로 회복 필요
```

### 회복 밸런스
```
완전 회복 예상 시간 (기본 300 HP 기준):
- HP 1 → 300 (사망 후): 약 60분 (5 HP/분)
- HP 150 → 300: 약 30분
- HP 200 → 300: 약 20분

회복 가속:
- 힐링 포션: 즉시 회복 (골드 소비)
- 휴식 장소: 회복 속도 2배
- VIP 버프: 회복 속도 +50%
```

---

## 데미지 계산 공식

### 물리 데미지
```
기본 데미지 = (Attack × 스킬 배율) - (적 AD_Defense × 0.5)
최종 데미지 = 기본 데미지 × 속성 배율 × 버프 배율 × 랜덤 변동(0.9~1.1)

최소 데미지 = 기본 데미지 × 0.1 (최소 1)
```

### 마법 데미지
```
기본 데미지 = (AP_Attack × 스킬 배율) - (적 AP_Defense × 0.4)
최종 데미지 = 기본 데미지 × 속성 배율 × 버프 배율 × 랜덤 변동(0.9~1.1)

최소 데미지 = 기본 데미지 × 0.15 (최소 1)
```

### 치명타 계산
```
치명타 발동 시:
최종 데미지 = 기본 데미지 × (Critical Damage / 100)

치명타 확률 = Critical Rate + 스킬 보너스 + 버프 보너스
최대 치명타 확률 = 80%
```

### 방어력 감소 계산
```
유효 방어력 = 적 방어력 × (1 - 방어 관통률)
방어 무시 = 해당 수치만큼 방어력 0으로 계산

최대 방어 관통률 = 70%
```

---

## 속성 상성 시스템

### 속성 상성표
```
🔥 화염 → ❄️ 냉기 (+50%) → ⚡ 번개 (+50%) → 💧 수속성 (+50%) → 🔥 화염
✨ 신성 ↔ 🌑 암흑 (서로 +50%)
```

### 속성 데미지 배율
| 상황 | 배율 |
|------|------|
| 강점 속성 공격 | ×1.5 (50% 추가) |
| 약점 속성 피격 | ×1.5 (50% 추가) |
| 동일 속성 공격 | ×0.5 (50% 감소) |
| 속성 면역 | ×0.0 (무효) |
| 속성 저항 | ×(1 - 저항률) |

### 속성 저항 계산
```
속성 데미지 = 기본 데미지 × (1 - 속성 저항률)
최대 속성 저항 = 75%
속성 면역 = 100% 저항
```

---

## 상태이상 시스템

### 지속 피해 (DOT)
| 상태 | 데미지 | 지속 | 중첩 |
|------|--------|------|------|
| 화상 | 최대 HP의 3%/턴 | 3턴 | 최대 5스택 |
| 독 | 최대 HP의 2%/턴 | 5턴 | 최대 3스택 |
| 출혈 | 최대 HP의 4%/턴 | 2턴 | 중첩 불가 |

### 상태이상 효과
| 상태 | 효과 | 기본 지속 |
|------|------|----------|
| 둔화 | 속도 -30% | 2턴 |
| 동결 | 행동 불가, 받는 피해 +20% | 1턴 |
| 마비 | 행동 불가 | 1턴 |
| 기절 | 행동 불가 | 1턴 |
| 공포 | 공격력/방어력 -20% | 2턴 |
| 저주 | 회복량 -50%, 방어력 -20% | 3턴 |
| 실명 | 명중률 -50% | 2턴 |

### 상태이상 저항
```
상태이상 적용 확률 = 기본 확률 × (1 - 저항률)
상태이상 저항 = 특정 장비/스킬/버프로 획득
최대 상태이상 저항 = 80% (보스는 기본 50% 저항)
```

---

## 경험치 및 레벨링

### 경험치 획득
```
기본 경험치 = 10 + (몬스터 레벨 × 5) × 몬스터 타입 배율
레벨 차이 보정:
  - 플레이어 > 몬스터 5레벨 이상: ×0.5
  - 플레이어 > 몬스터 10레벨 이상: ×0.1
  - 플레이어 < 몬스터: ×1.2 (보너스)
```

### 몬스터 타입별 경험치 배율
| 타입 | 배율 |
|------|------|
| CommonMob | ×1.0 |
| EliteMob | ×2.0 |
| BossMob | ×5.0 |
| RaidMob | ×10.0 |

### 필요 경험치 테이블
| 레벨 구간 | 공식 | 예시 |
|-----------|------|------|
| 1-10 | 100 × 레벨 | Lv.10: 1,000 |
| 11-20 | 200 × 레벨 | Lv.20: 4,000 |
| 21-30 | 400 × 레벨 | Lv.30: 12,000 |
| 31-40 | 800 × 레벨 | Lv.40: 32,000 |
| 41-50 | 1600 × 레벨 | Lv.50: 80,000 |
| 51-60 | 2400 × 레벨 | Lv.60: 144,000 |
| 61-70 | 3200 × 레벨 | Lv.70: 224,000 |
| 71-80 | 4200 × 레벨 | Lv.80: 336,000 |
| 81-90 | 5600 × 레벨 | Lv.90: 504,000 |
| 91-100 | 8000 × 레벨 | Lv.100: 800,000 |

### 누적 경험치
| 레벨 | 누적 경험치 | 비고 |
|------|-------------|------|
| 10 | 5,500 | 초보자 단계 |
| 20 | 38,500 | 중급자 |
| 30 | 143,500 | 고급자 |
| 40 | 423,500 | 엘리트 |
| 50 | 1,143,500 | 기존 만렙 |
| 60 | 2,420,500 | 차원 탐험가 |
| 70 | 4,600,500 | 심연 정복자 |
| 80 | 8,250,500 | 고대 유물 수집가 |
| 90 | 14,050,500 | 혼돈의 지배자 |
| 100 | 24,450,500 | 신의 영역 도달 |

---

## 드롭률 시스템

### 기본 드롭률
```
아이템 드롭 확률 = 기본 확률 × (1 + 행운 보너스) × 던전 배율
```

### 등급별 기본 드롭률
| 등급 | 일반몹 | 엘리트몹 | 보스 | 레이드 보스 |
|------|--------|----------|------|------------|
| D | 20% | 30% | 50% | - |
| C | 10% | 15% | 30% | - |
| B | 3% | 5% | 15% | 25% |
| A | 0.5% | 1% | 5% | 15% |
| S | 0.05% | 0.1% | 1% | 5% |
| SS | - | 0.01% | 0.3% | 2% |
| SSS | - | - | 0.05% | 0.5% |
| 신화 | - | - | 0.005% | 0.1% |

### 고레벨 던전 등급별 드롭률 보정
| 던전 레벨 | D~C 보정 | B~A 보정 | S+ 보정 |
|-----------|----------|----------|---------|
| Lv.51-60 | -10% | +10% | +20% |
| Lv.61-70 | -20% | +15% | +30% |
| Lv.71-80 | -30% | +20% | +50% |
| Lv.81-90 | -50% | +25% | +80% |
| Lv.91-100 | D~C 드롭 안함 | +30% | +100% |

### 드롭률 보너스
| 소스 | 보너스 |
|------|--------|
| 행운 패시브 | +10% |
| 보물 사냥꾼 패시브 | +30% |
| 전설의 사냥꾼 패시브 | 보스 2배 |
| 행운의 부적 (악세서리) | +5% |

---

## 장비 강화 시스템

### 강화 성공률
| 강화 단계 | 성공률 | 실패 시 |
|-----------|--------|---------|
| +1 ~ +3 | 100% | - |
| +4 ~ +6 | 80% | 강화 수치 유지 |
| +7 ~ +9 | 60% | 강화 수치 -1 |
| +10 ~ +12 | 40% | 강화 수치 -2 |
| +13 ~ +15 | 20% | 강화 초기화 (20% 파괴) |

### 강화 스탯 증가
```
강화 보너스 = 기본 스탯 × (강화 단계 × 0.05)
+15 강화 = 기본 스탯의 75% 추가

예시: Attack 100 무기
+5 = 100 + (100 × 0.25) = 125
+10 = 100 + (100 × 0.50) = 150
+15 = 100 + (100 × 0.75) = 175
```

### 축복/저주 시스템
```
축복받은 강화: 성공률 +10%, 실패 시 수치 유지
저주받은 강화: 성공률 -10%, 실패 시 파괴 확률 2배
```

---

## 키워드 밀도 시너지 시스템

덱에 장착한 스킬의 **키워드 구성**에 따라 자동으로 시너지 효과가 발동합니다. 스킬 이름이 아닌 키워드만 셉니다.

> 키워드 시스템 상세는 `docs/Skills.md` 참조

### 속성 키워드 밀도 시너지

**덱 내 같은 속성 키워드를 가진 스킬 수**에 따른 보너스:

| 속성 | 3개 | 5개 | 7개 | 10개 (마스터리) |
|------|-----|-----|-----|----------------|
| 화염 | 화염 +10% | 화염 +20%, 화상+1턴 | 화염 +35%, 화상 확률 +20% | 모든 공격 화상 부여, 화상 2배 |
| 냉기 | 냉기 +10% | 냉기 +20%, 동결+10% | 냉기 +35%, 동결 확률 2배 | 모든 공격 둔화, 50% 동결 |
| 번개 | 번개 +10% | 번개 +20%, 연쇄+1 | 번개 +35%, 마비 +30% | 모든 공격 2체 연쇄, 마비+30% |
| 수속성 | 회복 +15% | 회복 +25%, 턴당 HP3% | 회복 +40%, 화염 -30% | 매 턴 HP 10%, 힐 2배 |
| 신성 | 회복 +15% | 신성 +20%, 언데드+30% | 디버프 -50%, 회복 +35% | 디버프 면역, 언데드 2배 |
| 암흑 | 흡혈 +5% | 흡혈 +15%, 저주+1턴 | 흡혈 +25%, 처치 시 HP10% | 흡혈 +40%, 킬당 공격+5% |

### 키워드 조합 시너지

| 시너지 이름 | 키워드 조건 | 효과 |
|-------------|-----------|------|
| **원소 조화** | 화염+냉기+번개+수속성 각 2개+ | 모든 속성 +15% |
| **빛과 어둠** | 신성 4개+ & 암흑 4개+ | 데미지 +25%, 흡혈 +10% |
| **글래스 캐논** | attack 타입 8개+ | 데미지 +40%, 받는 피해 +20% |
| **철벽 방어** | heal/buff 타입 7개+ | 받는 피해 -25%, 데미지 -30% |
| **버서커** | attack 5개+ & 흡혈 키워드 포함 | 공격력 +15%, HP 50% 이하 시 +30% |
| **서바이버** | heal 타입 4개+ | 받는 피해 -15%, 힐 +20% |
| **상태이상 마스터** | 서로 다른 효과 키워드 3종+ | 상태이상 확률 +15%, 지속 +1턴 |
| **셋업-피니셔 특화** | 셋업 3개+ & 피니셔 3개+ | 콤보 보너스 +30% |
| **궁극기 특화** | 궁극기 2개+ | 궁극기 데미지 +50% (위험도 높음) |

### 시너지 스택 규칙
```
- 같은 종류의 시너지는 중첩되지 않음
- 다른 종류의 시너지는 모두 적용됨
- 마스터리(10개 집중)는 다른 속성 밀도 시너지와 함께 적용 불가

예시: 화염 키워드 7개 + attack 타입 8개
→ 화염 밀도 시너지(7개) + 글래스 캐논 = 화염 +35% & 데미지 +40%
```

---

### 덱 빌드 기대값 분석 (키워드 프로필 기반)

#### 화상 폭발 프로필
```
키워드: [화염 ×7, 화상 ×5, 셋업 ×3, 피니셔 ×2]

턴당 기대값:
- [셋업,화상] 발동 확률: 30% → 화상 스택 축적
- [피니셔,화상] 발동 확률: 20% → 스택 폭발
- 콤보 발생 확률: ~6%/턴 (셋업 후 피니셔)

시너지: 화염 밀도 7개 → 화염 +35%, 화상 확률 +20%
       화상 밀도 5개 → 화상 스택 상한 +3
       셋업-피니셔 특화 → 콤보 보너스 +30%

최종 기대 DPS: ~110% (콤보 미발동) / ~300%+ (콤보 발동 시)
생존력: 하 (힐 10% 확률)
```

#### 동결 컨트롤 프로필
```
키워드: [냉기 ×7, 동결 ×4, 둔화 ×3, 셋업 ×3, 피니셔 ×2]

턴당 기대값:
- [셋업,동결/둔화] 발동 확률: 30% → CC 부여
- [피니셔,동결] 발동 확률: 20% → 동결 분쇄
- 동결 확률: 평균 25% (밀도 시너지로 ~50%)

시너지: 냉기 밀도 7개 → 동결 확률 2배
       상태이상 마스터 (동결+둔화) → 확률 +15%

최종 기대 DPS: ~70% (CC 중심)
생존력: 중 (힐 20% + 적 동결로 턴 무효화)
```

#### 탱커 반격 프로필
```
키워드: [물리 ×5, 보호막 ×3, 반격 ×3, 피니셔 ×2, heal/buff ×4]

턴당 기대값:
- [반격] 자동 발동: 피격 시 80% 확률
- [피니셔,보호막] 발동 확률: 20% → 보호막 폭발
- 힐 기대값: 평균 HP 15%/턴

시너지: 보호막 밀도 3개 → 보호막 효율 +20%
       반격 전문 → 반격 데미지 +30%
       서바이버 → 피해 -15%, 힐 +20%

최종 기대 DPS: ~40% (반격 중심)
생존력: 최상 (피해 -40%, 턴당 HP 15% 회복)
```

---

### 세트 아이템 + 키워드 시너지

| 세트 | 키워드 프로필 | 결과 |
|------|-------------|------|
| 드래곤 6세트 | 번개 ×7 | 피격 반격 + 연쇄 = 카운터 빌드 |
| 심연 8세트 | 암흑 ×7, 흡혈 ×4 | 처치 시 능력 흡수 + 영구 성장 |
| 천상 8세트 | 신성 ×7, 축복 ×3 | 부활 + 디버프 면역 = 불사 빌드 |
| 화염 5세트 | 화염 ×5, 화상 ×3 | 화상 자동 부여 + 화염 데미지 극대화 |

---

## 전투 밸런스 가이드라인 (랜덤 스킬 기반)

### 권장 전투 시간
| 상대 | 권장 턴 수 | 비고 |
|------|-----------|------|
| 일반몹 | 3-4턴 | 랜덤이므로 약간 여유 |
| 엘리트몹 | 6-8턴 | 중간 난이도 |
| 보스몹 | 12-18턴 | 덱 구성 중요 |
| 레이드 보스 | 25-40턴 | 운과 전략 모두 필요 |

### 기대 DPS 기반 밸런싱
```
플레이어 턴당 기대 DPS (레벨 기준):
- 공격 덱(7개): 레벨 × 3 × 0.7 = 레벨 × 2.1
- 밸런스 덱(5개): 레벨 × 3 × 0.5 = 레벨 × 1.5
- 방어 덱(3개): 레벨 × 3 × 0.3 = 레벨 × 0.9

권장 몬스터 HP:
- 일반몹 HP ≈ 플레이어 기대 DPS × 4턴 분량
- 엘리트몹 HP ≈ 플레이어 기대 DPS × 8턴 분량
- 보스몹 HP ≈ 플레이어 기대 DPS × 15턴 분량
```

### 회복량 밸런스 (확률 고려)
```
힐 스킬 발동 확률에 따른 기대 회복:
- 힐 1개(10%): 턴당 기대 회복 = 힐량 × 0.1
- 힐 2개(20%): 턴당 기대 회복 = 힐량 × 0.2
- 힐 3개(30%): 턴당 기대 회복 = 힐량 × 0.3

권장 힐 스킬 위력:
- D등급 힐: 최대 HP의 15%
- C등급 힐: 최대 HP의 25%
- B등급 힐: 최대 HP의 30%
- A등급 힐: 최대 HP의 50%
- S등급 힐: 최대 HP의 80%

생존을 위한 최소 힐 장착: 2개 이상 권장 (20% 발동률)
```

### 버프/디버프 밸런스
```
랜덤 발동이므로 버프/디버프 지속시간이 중요:

적정 버프 수치:
- 약한 버프: +15-20% (3턴) - 덱에 2-3개 권장
- 중간 버프: +25-35% (3턴) - 덱에 1-2개 권장
- 강한 버프: +40-50% (5턴) - 덱에 1개 권장

지속시간 3턴 기준:
- 버프 1개(10%): 평균 0.3턴 유지
- 버프 2개(20%): 평균 0.6턴 유지
- 버프 3개(30%): 평균 0.9턴 유지
→ 버프 유지를 원하면 3개 이상 장착 필요
```

### 운 요소 완화 설계
```
나쁜 운 보호 장치:
1. 버프 지속시간 최소 3턴 (발동 후 유지)
2. 연속 3턴 공격 미발동 시 다음 턴 공격 확정
3. 전투 시작 시 1턴은 공격 스킬 우선 발동
4. 궁극기는 발동 후 슬롯 소모로 "확정 사용" 느낌

좋은 운 제한:
1. 같은 스킬 연속 발동 시 두 번째부터 위력 -20%
2. 버프 중첩 시 효과 50%만 적용
```

---

## 경제 밸런스

### 화폐 획득
```
몬스터 드롭: 레벨 × 2 × 타입 배율
던전 클리어 보상: 던전 레벨 × 50
일일 퀘스트: 500-2000
주간 퀘스트: 5000-20000
레이드 보상: 10000-50000
```

### 화폐 소비
| 항목 | 비용 범위 |
|------|----------|
| 초급 포션 | 50 |
| 중급 포션 | 150 |
| 고급 포션 | 400 |
| D등급 장비 | 500-1000 |
| C등급 장비 | 2000-5000 |
| B등급 장비 | 10000-25000 |
| A등급 장비 | 50000-100000 |
| 일반 강화 주문서 | 200 |
| 중급 강화 주문서 | 1000 |
| 고급 강화 주문서 | 5000 |

### 경제 밸런스 원칙
```
1. 레벨업에 필요한 평균 골드 = 필요 경험치 × 0.5
2. 적정 장비 구매 = 해당 레벨 던전 20회 클리어 분량
3. 풀 강화 비용 = 해당 등급 장비 × 3
4. 인플레이션 방지: 수리비, 강화 실패, 소비 아이템
```

---

## 난이도 곡선

### 레벨별 체감 난이도
| 레벨 구간 | 난이도 | 주요 콘텐츠 | 목표 |
|-----------|--------|------------|------|
| 1-10 | 쉬움 | 튜토리얼 던전 | 시스템 학습 |
| 11-20 | 보통 | 속성 던전 입문 | 속성 상성 이해 |
| 21-30 | 어려움 | 보스 던전 본격화 | 빌드 구축 |
| 31-40 | 매우 어려움 | 엘리트 던전 | 시너지 최적화 |
| 41-50 | 극한 | 레이드 | 팀플레이, 기믹 숙지 |
| 51-60 | 지옥 | 차원 균열 | 다중 속성 대응 |
| 61-70 | 심연 | 심연 던전 | 각성 스킬 활용 |
| 71-80 | 초월 | 고대 유적 | 유물 장비 세팅 |
| 81-90 | 신화 | 혼돈의 영역 | 초월 시스템 마스터 |
| 91-100 | 불멸 | 신계 던전, 최종 레이드 | 완벽한 빌드, 신화 등급 장비 |

### 신규 플레이어 보호
```
1. 레벨 10까지 사망 패널티 없음
2. 튜토리얼 완료 시 C등급 장비 세트 지급
3. 첫 보스 처치 시 스킬북 선택권 지급
4. 일일 무료 부활 1회
```

---

## 밸런스 조정 히스토리 템플릿

```markdown
### 버전 X.X.X (YYYY-MM-DD)

#### 버프
- [스킬명] 데미지 100% → 120%
- [아이템명] 스탯 +5 → +8

#### 너프
- [스킬명] 쿨타임 3턴 → 4턴
- [시너지명] 효과 +30% → +20%

#### 버그 수정
- [버그 내용] 수정

#### 밸런스 의도
- 해당 변경의 목적과 예상 영향
```
