# 능력치 시스템 (Stats System)

## 개요

플레이어는 레벨업 시 획득하는 **스탯 포인트**를 5대 기본 능력치에 분배합니다.
기본 능력치는 실제 전투에 사용되는 **전투 스탯**으로 변환되며, 특정 조건을 충족하면 **시너지 효과**가 자동 발동됩니다.

```
[스탯 포인트] → [5대 능력치 분배] → [전투 스탯 변환] + [시너지 보너스]
                                          ↓
                                    [데미지 계산, 전투에 적용]
```

---

## 5대 기본 능력치

| 능력치 | 한국어 | 핵심 역할 | 설명 |
|--------|--------|-----------|------|
| **STR** | 힘 | 물리 딜러 | 물리 공격의 근간. 부가적으로 HP와 방어력도 소폭 상승 |
| **INT** | 지능 | 마법 딜러 | 마법 공격의 원천. 마법 방어와 HP도 소량 제공 |
| **DEX** | 민첩 | 속도/회피/명중 | 유일한 속도 소스. 회피/명중/물리공격 보조 |
| **VIT** | 활력 | 탱킹/생존 | HP 최고 효율 + 방어력. 생존의 기반 |
| **LUK** | 행운 | 치명타/드롭 | 치명타 특화 + 드롭률 보너스. 리스크/리턴형 |

---

## 포인트 예산

```
레벨당 스탯 포인트: 3
최대 레벨: 100
총 포인트: ~300

빌드 예시:
  극특화: 한 스탯 150~200, 나머지 최소
  듀얼 특화: 두 스탯 각 80~100
  균형형: 각 스탯 ~60
```

---

## 전투 스탯 변환표

기본 능력치 1포인트당 전투 스탯 증가량:

| 전투 스탯 | STR | INT | DEX | VIT | LUK |
|-----------|-----|-----|-----|-----|-----|
| **HP** | +5 | +2 | — | **+12** | — |
| **물리 공격** | **+2.5** | — | +1 | — | +0.5 |
| **마법 공격** | — | **+2.5** | — | — | — |
| **물리 방어** | +0.3 | — | — | **+1.2** | — |
| **마법 방어** | — | +0.8 | — | +0.5 | — |
| **속도** | — | — | **+1** | — | — |
| **명중률** | — | — | +0.4% | — | — |
| **회피율** | — | — | **+0.3%** | — | +0.1% |
| **치명타 확률** | — | — | +0.1% | — | **+0.3%** |
| **치명타 데미지** | — | — | — | — | **+1%** |
| **HP 자연회복** | — | — | — | +0.04%/분 | — |
| **드롭률 보너스** | — | — | — | — | +0.5% |

### 변환 공식

```python
# 능력치 → 전투 스탯 변환
bonus_hp         = (STR * 5) + (INT * 2) + (VIT * 12)
bonus_attack     = (STR * 2.5) + (DEX * 1) + (LUK * 0.5)
bonus_ap_attack  = (INT * 2.5)
bonus_ad_defense = (STR * 0.3) + (VIT * 1.2)
bonus_ap_defense = (INT * 0.8) + (VIT * 0.5)
bonus_speed      = (DEX * 1)
bonus_accuracy   = (DEX * 0.4)          # %
bonus_evasion    = (DEX * 0.3) + (LUK * 0.1)  # %
bonus_crit_rate  = (DEX * 0.1) + (LUK * 0.3)  # %
bonus_crit_dmg   = (LUK * 1.0)          # %
bonus_hp_regen   = (VIT * 0.04)         # 최대 HP의 %/분
bonus_drop_rate  = (LUK * 0.5)          # %
```

### HP 자연회복 시스템

HP 자연회복은 **최대 HP 비례 %** 방식:

```
자연회복량/분 = 최대 HP × (기본 회복률 + VIT 보너스)

기본 회복률 = 1%/분
VIT 보너스 = VIT × 0.04%/분

예시:
  VIT 0   → 최대 HP의 1%/분
  VIT 25  → 최대 HP의 2%/분
  VIT 50  → 최대 HP의 3%/분
  VIT 75  → 최대 HP의 4%/분
  VIT 100 → 최대 HP의 5%/분
```

---

## 최종 전투 스탯 계산

```
최종 스탯 = 레벨 기본 스탯 + 능력치 보너스 + 장비 스탯 + 버프
```

- **레벨 기본 스탯**: 레벨에 따른 고정 성장 (Balance.md 참조)
- **능력치 보너스**: 5대 능력치에서 변환된 전투 스탯
- **장비 스탯**: 장비가 직접 부여하는 전투 스탯 (기존 방식 유지)
- **버프**: 전투 중 스킬/시너지에 의한 일시적 증가

---

## 시너지 효과

능력치 투자량이 특정 조건을 충족하면 **자동 발동**되는 보너스 효과.
3단계 티어로 구분되며, 조건만 충족하면 모두 중첩 적용.

### Tier 1 — 기초 시너지 (2개 능력치 15+)

낮은 투자로 발동. 빌드 방향을 잡기 시작하는 보너스.

| 시너지 | 조건 | 효과 |
|--------|------|------|
| **강인함** | STR 15 & VIT 15 | HP +3%, 물리 데미지 +3% |
| **야생의 본능** | STR 15 & DEX 15 | 명중률 +3%, 물리 데미지 +3% |
| **행운의 주먹** | LUK 15 & STR 15 | 치명타 데미지 +5%, 물리 공격 +3% |
| **마법 갑옷** | INT 15 & VIT 15 | 마법 방어 +5%, HP +3% |
| **민첩한 지성** | INT 15 & DEX 15 | 마법 데미지 +3%, 속도 +2 |
| **행운의 지팡이** | LUK 15 & INT 15 | 치명타 데미지 +5%, 마법 공격 +3% |
| **행운의 손길** | LUK 15 & DEX 15 | 치명타 확률 +2%, 회피 +2% |

### Tier 2 — 빌드 시너지 (단일 30+ 또는 듀얼 25+)

빌드 정체성이 확립되는 구간. 플레이스타일을 규정.

**단일 특화:**

| 시너지 | 조건 | 효과 |
|--------|------|------|
| **광전사** | STR 30 | 물리 데미지 +8%, HP 50% 이하 시 추가 +10%, HP 25% 이하 시 흡혈 +10% |
| **대마도사** | INT 30 | 마법 데미지 +8%, 마법 관통 +5% |
| **질풍** | DEX 30 | 회피 +5%, 선공 확정 |
| **불굴** | VIT 30 | HP +10%, 받는 피해 -5% |
| **도박사** | LUK 30 | 치명타 데미지 +15%, 드롭률 +10% |

**듀얼 조합:**

| 시너지 | 조건 | 효과 |
|--------|------|------|
| **마법 검사** | STR 25 & INT 25 | 물리+마법 데미지 +6% |
| **암살자** | DEX 25 & LUK 25 | 치명타 확률 +5%, 치명타 데미지 +10% |
| **수호자** | VIT 25 & STR 25 | 받는 피해 -8%, 방어력 +10% |
| **현자** | VIT 25 & INT 25 | 마법 방어 +10%, 회복량 +10% |
| **유령** | DEX 25 & VIT 25 | 회피 +5%, HP +5%, 상태이상 저항 +10% |

### Tier 3 — 극특화 시너지 (단일 50+ 또는 듀얼 40+)

극한 투자에 대한 보상. 강력하지만 다른 능력치를 희생.

**단일 극특화:**

| 시너지 | 조건 | 효과 |
|--------|------|------|
| **전쟁의 신** | STR 50 | 물리 데미지 +15%, 방어 관통 +10% |
| **대현자** | INT 50 | 마법 데미지 +15%, 마법 관통 +10% |
| **잔영** | DEX 50 | 회피 +10%, 5% 확률로 추가 행동 |
| **영생** | VIT 50 | HP +20%, 턴당 HP 2% 자동 회복 |
| **운명의 총아** | LUK 50 | 치명타 확률 +10%, 드롭률 2배 |

**듀얼 극특화:**

| 시너지 | 조건 | 효과 |
|--------|------|------|
| **파괴자** | STR 40 & LUK 40 | 물리 치명타 시 데미지 +25% |
| **원소 지배자** | INT 40 & DEX 40 | 마법 데미지 +12%, 속성 데미지 +10% |
| **불멸의 요새** | VIT 40 & STR 40 | 받는 피해 -12%, HP 20% 이하 시 방어력 2배 |

**특수:**

| 시너지 | 조건 | 효과 |
|--------|------|------|
| **균형의 달인** | 모든 스탯 20+ | 모든 전투 스탯 +5%, 버프 지속 +1턴 |

### 시너지 스택 규칙

```
- 다른 티어의 시너지는 모두 중첩 적용
  예: 광전사(T2) + 전쟁의 신(T3) = 동시 적용
- 같은 티어 내에서도 조건만 충족하면 모두 적용
- 같은 계열 %는 가산 (곱연산 아님)
  예: 물리 데미지 +8%(광전사) + +15%(전쟁의 신) = +23%
- 조건부 효과는 조건 충족 시에만 적용
  예: HP 50% 이하 시 +10%(광전사) → 평소에는 미적용
```

---

## 장비 착용 조건

능력치는 **장비 착용 조건**에도 사용됩니다. 장비 계열에 따라 특정 능력치가 요구됩니다.

- 대검/중갑 → STR 요구
- 지팡이/로브 → INT 요구
- 단검/경갑 → DEX 요구
- 방패 → VIT 요구
- 등급이 높을수록 요구치 상승 (D등급 0 → 신화 90)

> 장비 착용 조건 상세는 [Items.md](Items.md) 참조

---

## 빌드 예시

### 물리 전사 (레벨 50, 150포인트)

```
능력치: STR 60 / VIT 40 / DEX 30 / INT 0 / LUK 20
착용 가능: S등급 대검(STR 40), S등급 중갑(STR 40, VIT 20)

전투 스탯 보너스:
  HP:        +300(STR) +480(VIT) = +780
  물리 공격:  +150(STR) +30(DEX) +10(LUK) = +190
  물리 방어:  +18(STR) +48(VIT) = +66
  속도:       +30(DEX)
  치명타 확률: +3%(DEX) +6%(LUK) = +9%
  치명타 데미지: +20%(LUK)
  자연회복:   1% + 1.6%(VIT) = 2.6%/분

발동 시너지:
  [T1] 강인함        → HP +3%, 물리 데미지 +3%
  [T1] 야생의 본능   → 명중률 +3%, 물리 데미지 +3%
  [T1] 행운의 주먹   → 치명타 데미지 +5%, 물리 공격 +3%
  [T2] 광전사        → 물리 데미지 +8%, 반피 시 +10%
  [T2] 질풍          → 회피 +5%, 선공 확정
  [T2] 수호자        → 받는 피해 -8%, 방어력 +10%
  [T3] 전쟁의 신     → 물리 데미지 +15%, 관통 +10%

총 물리 데미지 보너스: +29% (반피 시 +39%)
```

### 마법사 (레벨 50, 150포인트)

```
능력치: INT 55 / VIT 35 / DEX 30 / STR 0 / LUK 30
착용 가능: S등급 지팡이(INT 40), S등급 로브(INT 40, VIT 20)

전투 스탯 보너스:
  HP:        +110(INT) +420(VIT) = +530
  마법 공격:  +137(INT)
  마법 방어:  +44(INT) +17.5(VIT) = +61
  속도:       +30(DEX)
  치명타 확률: +3%(DEX) +9%(LUK) = +12%
  치명타 데미지: +30%(LUK)
  자연회복:   1% + 1.4%(VIT) = 2.4%/분

발동 시너지:
  [T1] 마법 갑옷      → 마법 방어 +5%, HP +3%
  [T1] 민첩한 지성    → 마법 데미지 +3%, 속도 +2
  [T1] 행운의 지팡이  → 치명타 데미지 +5%, 마법 공격 +3%
  [T1] 행운의 손길    → 치명타 확률 +2%, 회피 +2%
  [T2] 대마도사       → 마법 데미지 +8%, 마법 관통 +5%
  [T2] 질풍           → 회피 +5%, 선공 확정
  [T2] 도박사         → 치명타 데미지 +15%, 드롭률 +10%
  [T2] 현자           → 마법 방어 +10%, 회복량 +10%
  [T3] 대현자         → 마법 데미지 +15%, 마법 관통 +10%

총 마법 데미지 보너스: +26%, 마법 관통 +15%
```

### 암살자 (레벨 50, 150포인트)

```
능력치: DEX 50 / LUK 50 / STR 30 / VIT 10 / INT 10
착용 가능: S등급 단검(DEX 40), A등급 경갑(DEX 30, VIT 15)

전투 스탯 보너스:
  HP:        +150(STR) +20(INT) +120(VIT) = +290
  물리 공격:  +75(STR) +50(DEX) +25(LUK) = +150
  속도:       +50(DEX)
  회피율:     +15%(DEX) +5%(LUK) = +20%
  치명타 확률: +5%(DEX) +15%(LUK) = +20%
  치명타 데미지: +50%(LUK)
  자연회복:   1% + 0.4%(VIT) = 1.4%/분

발동 시너지:
  [T1] 야생의 본능   → 명중률 +3%, 물리 데미지 +3%
  [T1] 행운의 주먹   → 치명타 데미지 +5%, 물리 공격 +3%
  [T1] 행운의 손길   → 치명타 확률 +2%, 회피 +2%
  [T2] 광전사        → 물리 데미지 +8%, 반피 시 +10%
  [T2] 질풍          → 회피 +5%, 선공 확정
  [T2] 도박사        → 치명타 데미지 +15%, 드롭률 +10%
  [T2] 암살자        → 치명타 확률 +5%, 치명타 데미지 +10%
  [T3] 잔영          → 회피 +10%, 5% 추가 행동
  [T3] 운명의 총아   → 치명타 확률 +10%, 드롭률 2배

최종 치명타 확률: 5%(기본) + 20%(능력치) + 2% + 5% + 10% = 42%
최종 치명타 데미지: 150%(기본) + 50%(능력치) + 5% + 15% + 10% = 230%
→ 한방 극대화, 생존력 최하
```

### 탱커 (레벨 50, 150포인트)

```
능력치: VIT 60 / STR 40 / DEX 20 / INT 10 / LUK 20
착용 가능: S등급 중갑(STR 40, VIT 20), S등급 방패(VIT 40, STR 20)

전투 스탯 보너스:
  HP:        +200(STR) +20(INT) +720(VIT) = +940
  물리 공격:  +100(STR) +20(DEX) +10(LUK) = +130
  물리 방어:  +12(STR) +72(VIT) = +84
  마법 방어:  +8(INT) +30(VIT) = +38
  속도:       +20(DEX)
  자연회복:   1% + 2.4%(VIT) = 3.4%/분

발동 시너지:
  [T1] 강인함        → HP +3%, 물리 데미지 +3%
  [T1] 야생의 본능   → 명중률 +3%, 물리 데미지 +3%
  [T1] 행운의 주먹   → 치명타 데미지 +5%, 물리 공격 +3%
  [T2] 불굴          → HP +10%, 받는 피해 -5%
  [T2] 수호자        → 받는 피해 -8%, 방어력 +10%
  [T3] 불멸의 요새   → 받는 피해 -12%, HP 20% 이하 시 방어력 2배

총 받는 피해 감소: -25%
→ 최고 생존력, 딜은 보조 수준
```

### 균형형 (레벨 50, 150포인트)

```
능력치: STR 30 / INT 30 / DEX 30 / VIT 30 / LUK 30

발동 시너지:
  [T1] 전부 발동 (7개)
  [T2] 5대 단일 시너지 전부 발동
  [T3] 균형의 달인 → 모든 전투 스탯 +5%, 버프 지속 +1턴

→ 시너지 다수 발동으로 안정적
→ 극특화 대비 최대 DPS는 낮지만 적응력 최상
```

---

## 기존 시스템과의 호환

| 항목 | 변경 전 | 변경 후 |
|------|---------|---------|
| DB 보너스 필드 | `bonus_hp`, `bonus_attack`, `bonus_ad_defense`, `bonus_ap_attack`, `bonus_ap_defense`, `bonus_speed` | `bonus_str`, `bonus_int`, `bonus_dex`, `bonus_vit`, `bonus_luk` |
| 스탯 분배 UI | 6개 전투 스탯 직접 선택 | 5대 능력치 선택 |
| `get_stat()` | 기본 + 보너스 + 장비 | 기본 + **능력치 변환** + 장비 |
| `calculate_base_stats()` | 레벨 기반 전투 스탯 (유지) | 유지 (능력치 보너스는 별도 가산) |
| `damage_calculator.py` | 변경 없음 | 변경 없음 (입력 스탯 값만 달라짐) |
| 장비 스탯 | 전투 스탯 직접 부여 (유지) | 유지 (추후 능력치 부여 장비 추가 가능) |
| HP 자연회복 | 고정값 (`hp_regen` HP/분) | 최대 HP의 %/분 (기본 1% + VIT 보너스) |
| 스탯 리셋 | 미구현 | 구현 필요 (능력치 초기화) |

---

## DB 스키마 변경

### User 모델 (변경)

```python
# 제거할 필드
bonus_hp = fields.IntField(default=0)        # 삭제
bonus_attack = fields.IntField(default=0)     # 삭제
bonus_ap_attack = fields.IntField(default=0)  # 삭제
bonus_ad_defense = fields.IntField(default=0) # 삭제
bonus_ap_defense = fields.IntField(default=0) # 삭제
bonus_speed = fields.IntField(default=0)      # 삭제

# 추가할 필드
bonus_str = fields.IntField(default=0)  # 힘
bonus_int = fields.IntField(default=0)  # 지능
bonus_dex = fields.IntField(default=0)  # 민첩
bonus_vit = fields.IntField(default=0)  # 활력
bonus_luk = fields.IntField(default=0)  # 행운
```

### HP 자연회복 필드 (변경)

```python
# 제거
hp_regen = fields.IntField(default=5)  # 고정값 삭제

# 자연회복은 VIT에서 계산되므로 별도 필드 불필요
# 계산: 최대HP × (0.01 + bonus_vit × 0.0004)
```
